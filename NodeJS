const express = require("express");
const bodyParser = require("body-parser");
const axios = require("axios");

const token = "7160964981:AAF2ILMqsBoREb4hWS1QIt_-1e_ZWZWKK0I"; // Your bot token
const webhookUrl = "https://hook.us2.make.com/fq2o5mke7wrp1kwjlwc63st6qq50dg64"; // Your Make.com webhook URL
const app = express();

app.use(bodyParser.json());

// Telegram webhook handler
app.post("/api/server", (req, res) => {
    const msg = req.body.message;

    if (!msg || !msg.text) {
        return res.status(200).send("No valid message to process.");
    }

    // Forward message to Make.com
    const payload = {
        Message: msg.text,
        from: msg.from.username || msg.from.id,
        chatId: msg.chat.id,
        messageId: msg.message_id,
    };

    axios.post(webhookUrl, payload)
        .then(() => {
            res.status(200).send("Message forwarded successfully.");
        })
        .catch(err => {
            console.error("Error forwarding message:", err.message);
            res.status(500).send("Error forwarding message.");
        });
});

// Export Express app for Vercel
module.exports = app;
